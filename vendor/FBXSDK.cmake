IF(WIN32)
    SET(LIB_EXTENSION ".lib")
ELSE(WIN32)
    SET(LIB_EXTENSION ".a")
    IF(FBX_SHARED)
        IF(APPLE)
            SET(LIB_EXTENSION ".dylib")
        ELSEIF(UNIX)
            SET(LIB_EXTENSION ".so")
        ENDIF()
    ENDIF()
ENDIF(WIN32)

SET(FBX_SDK libfbxsdk${LIB_EXTENSION})

IF(NOT FBX_ARCH)
    SET(FBX_ARCH "x64")
    IF(WIN32 AND NOT CMAKE_CL_64)
        SET(FBX_ARCH "x86")
    ENDIF()
ENDIF()

IF(FBX_SHARED)   
    add_library(fbx SHARED IMPORTED)
ELSE()
    add_library(fbx STATIC IMPORTED)
ENDIF()
IF(WIN32)   
    SET(FBX_VARIANT "${CMAKE_BUILD_TYPE}")
    IF("${CMAKE_BUILD_TYPE}" STREQUAL "RelWithDebInfo")
        SET(FBX_VARIANT "Release")
    ENDIF()
    
    IF(MSVC_VERSION GREATER 1699 AND MSVC_VERSION LESS 1800)
        SET(FBX_COMPILER "vs2012")
    ELSEIF(MSVC_VERSION GREATER 1799 AND MSVC_VERSION LESS 1900)
        SET(FBX_COMPILER "vs2013")
    ELSEIF(MSVC_VERSION GREATER 1899 AND MSVC_VERSION LESS 1911)
        SET(FBX_COMPILER "vs2015")
    ELSEIF(MSVC_VERSION GREATER 1910 AND MSVC_VERSION LESS 1921)
        SET(FBX_COMPILER "vs2017")
    ELSEIF(MSVC_VERSION GREATER 1920 AND MSVC_VERSION LESS 2000)
        SET(FBX_COMPILER "vs2019")
    ENDIF()
    SET(FBX_TARGET_LIBS_PATH "${FBXSDK_DIR}/lib/${FBX_COMPILER}/${FBX_ARCH}/${FBX_VARIANT}")
    SET(FBX_SDK_ABS ${FBX_TARGET_LIBS_PATH}/${FBX_SDK})
    SET(FBX_REQUIRED_LIBS_DEPENDENCY ${FBX_SDK_ABS})
    IF(NOT FBX_SHARED)
        #IF(FBX_STATIC_RTL)
            SET(FBX_CC_RTL "/MT")
            SET(FBX_CC_RTLd "/MTd")
            SET(FBX_RTL_SUFFX "-mt")
        #ELSE()
        #    SET(FBX_CC_RTL "/MD")
        #    SET(FBX_CC_RTLd "/MDd")
        #    SET(FBX_RTL_SUFFX "-md")
        #ENDIF()
        
        set_property(TARGET fbx PROPERTY IMPORTED_LOCATION ${FBX_TARGET_LIBS_PATH}/libfbxsdk${FBX_RTL_SUFFX}${LIB_EXTENSION})
        IF(FBX_SHARED)   
            add_library(z SHARED IMPORTED)
            add_library(xml2 SHARED IMPORTED)
        ELSE()
            add_library(z STATIC IMPORTED)
            add_library(xml2 STATIC IMPORTED)
        ENDIF()
        
        set_property(TARGET z PROPERTY IMPORTED_LOCATION ${FBX_TARGET_LIBS_PATH}/zlib${FBX_RTL_SUFFX}${LIB_EXTENSION})
        set_property(TARGET xml2 PROPERTY IMPORTED_LOCATION ${FBX_TARGET_LIBS_PATH}/libxml2${FBX_RTL_SUFFX}${LIB_EXTENSION})
    ENDIF()
ELSE()
    SET(FBX_COMPILER "gcc")
    SET(FBX_VARIANT "${CMAKE_BUILD_TYPE}")
    SET(FBX_TARGET_LIBS_PATH "${FBXSDK_DIR}/lib/${FBX_COMPILER}/${FBX_ARCH}/${FBX_VARIANT}")
    SET(FBX_EXTRA_LIBS_PATH ${FBX_TARGET_LIBS_PATH}/lib)
    SET(FBX_SDK_ABS ${FBX_EXTRA_LIBS_PATH}fbxsdk${LIB_EXTENSION})
    set_property(TARGET fbx PROPERTY IMPORTED_LOCATION ${FBX_SDK_ABS})
ENDIF()
target_include_directories(fbx SYSTEM INTERFACE
  "${FBXSDK_DIR}/include"
)

if("${CMAKE_CXX_COMPILER_ID}" STREQUAL "MSVC")
    target_link_options(fbx INTERFACE "/ignore:4099")
endif()